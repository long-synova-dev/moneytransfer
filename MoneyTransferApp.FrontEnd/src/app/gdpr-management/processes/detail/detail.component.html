<div class="task-detail-backdrop">
    <div class="container" *ngIf="readyToLoad">
        <div class="task-detail pmd-z-depth-1" [ngClass]="{'task-detail--info': taskDetail.isControl}">
            <div class="task-detail__inner">
                <div class="task-detail__name">
                    <div class="col-md-6">
                        {{'Task.TaskDetailName' | translate}}:
                        <strong>{{taskDetail.taskTitle}}</strong>
                    </div>
                    <div class="col-md-6">
                        {{'Task.ProcessName' | translate}}:
                        <strong>{{taskDetail.processName}}</strong>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-6">
                        <div class="task-detail__panel">
                            <div class="task-detail__todo-block" style="max-height: 180px; overflow-y: auto;">
                                <table class="info-table">
                                    <tr>
                                        <td>{{'Task.PerformerDeadline' | translate}}: </td>
                                        <td><strong *ngIf="taskDetail.performerDeadline">{{taskDetail.performerDeadline | dateformatpipe}}</strong></td>
                                    </tr>
                                    <tr *ngIf="taskDetail.reviewerDeadline">
                                        <td>{{'Task.ReviewerDeadline' | translate}}: </td>
                                        <td><strong *ngIf="taskDetail.reviewerDeadline">{{taskDetail.reviewerDeadline | dateformatpipe}}</strong></td>
                                    </tr>
                                    <tr>
                                        <td>{{'Task.TaskPeriod' | translate}}: </td>
                                        <td><strong *ngIf="taskDetail.endDate ">{{taskDetail.startDate | dateformatpipe}} - {{taskDetail.endDate | dateformatpipe}}</strong><strong *ngIf="!taskDetail.endDate ">{{'Task.TaskDetailNeverEnd' | translate}}</strong></td>
                                    </tr>
                                    <tr>
                                        <td>{{'Task.TaskStatus' | translate}}</td>
                                        <td>
                                            <ng-select disabled="true"
                                                [options]="defineTaskStatus"
                                                [(ngModel)]="taskDetail.taskStatus"
                                                noFilter="10">
                                            </ng-select>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <div class="task-detail__panel">
                            <h3>{{'Task.TaskDetailDescription' | translate}}</h3>
                            <p>{{taskDetail.taskDesc}}</p>
                        </div>
                        <div class="task-detail__panel">
                            <table  class="info-table">
                                <tr>
                                    <td>{{'Task.TaskDetailResponsible' | translate}}: </td>
                                    <td>
                                        <ng-select disabled="true"
                                            class="users-select"
                                            placeholder="Select a person"
                                            [options]="defineUserInCompany"
                                            noFilter="10"
                                            [(ngModel)]="taskDetail.responsibleId"
                                            >
                                            <ng-template
                                                #optionTemplate
                                                let-option="option">
                                                <div class="select-avatar">{{option?.label.toLowerCase()}}</div>
                                                {{option?.label}}
                                            </ng-template>
                                        </ng-select>
                                    </td>
                                </tr>
                                <tr *ngIf="taskDetail.reviewerDeadline">
                                    <td>{{'Task.TaskDetailReviewer' | translate}}: </td>
                                    <td>
                                        <ng-select disabled="true"
                                            class="users-select"
                                            placeholder="Select a person"
                                            [options]="defineUserInCompany"
                                            noFilter="10"
                                            [(ngModel)]="taskDetail.reviewerId"
                                            >
                                            <ng-template
                                                #optionTemplate
                                                let-option="option">
                                                <div class="select-avatar">{{option?.label.toLowerCase()}}</div>
                                                {{option?.label}}
                                            </ng-template>
                                        </ng-select>
                                    </td>
                                </tr>
                                <tr>
                                    <td>{{'Task.TaskDetailPerformer' | translate}}: </td>
                                    <td>
                                        <ng-select disabled="true"
                                            class="users-select"
                                            placeholder="Select a person"
                                            [options]="defineUserInCompany"
                                            noFilter="10"
                                            [(ngModel)]="taskDetail.performerId"
                                            >
                                            <ng-template
                                                #optionTemplate
                                                let-option="option">
                                                <div class="select-avatar">{{option?.label.toLowerCase()}}</div>
                                                {{option?.label}}
                                            </ng-template>
                                        </ng-select>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="task-detail__panel">
                            <h3>{{'Task.TaskDetailHistory' | translate}}</h3>
                            <div *ngIf="listHistory.length == 0">{{'Task.HistoryNotFound' | translate}}</div>
                            <div style="max-height: 150px; overflow-y: auto;" *ngIf="listHistory.length > 0">
                                <div class="history-item mb10" *ngFor="let item of listHistory">
                                    <div class="media-body media-middle">
                                        <h3 class="pmd-card-title-text">{{item.date | dateformatpipe: true}}</h3>
                                        <span class="pmd-card-subtitle-text">
                                            <p *ngIf="item.fieldName == 'Management.ControlAssercertions'"><strong>{{item.owner}}</strong> changed <strong>{{item.fieldName | translate}}</strong></p>
                                            <p *ngIf="item.fieldName == 'Todo'"><strong>{{item.owner}}</strong> updated <strong>{{item.fieldName | translate}}</strong></p>
                                            <p *ngIf="item.fieldName == 'Task'"><strong>{{item.owner}}</strong> added new task: <strong>{{item.newValue}}</strong></p>
                                            <p *ngIf="item.fieldName && item.newValue">
                                                <strong>{{item.owner}}</strong> updated the <strong>{{item.fieldName | translate}}</strong> from <strong>{{item.oldValue | translate}}</strong> to <strong>{{item.newValue | translate}}</strong>
                                            </p>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-6">
                        <div class="task-detail__panel">
                            <h3>{{'Task.TaskDetailPerformerTask' | translate}}</h3>
                            <table class="table pmd-table list-todos-table">
                                <thead>
                                    <tr>
                                        <th colspan="2">{{'Task.TaskDetailYourTodo' | translate}}</th>
                                        <!-- <th>{{'Task.TaskDetailDocumentRequired' | translate}}</th> -->
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let todo of taskDetail.todos">
                                        <td>
                                            <label class="checkbox-inline pmd-checkbox pmd-checkbox-ripple-effect">
                                                <input type="checkbox" name="" [checked]="todo.isPerformed" disabled><span class="pmd-checkbox-label">&nbsp;</span>
                                            </label>
                                        </td>
                                        <td>{{todo.title}}</td>
                                        <!-- <td><i class="material-icons">attach_file</i> {{'Task.TaskDetailDownloadFile' | translate}}</td> -->
                                    </tr>
                                </tbody>
                            </table>
                            <div class="form-group pmd-textfield pmd-textfield-floating-label" [ngClass]="{
                                'pmd-textfield-floating-label-completed': taskDetail.taskResultComment
                            }">
                                <label for="taskName" class="control-label">
                                    {{ 'Task.TaskDetailTaskResult' | translate }}
                                </label>
                                <textarea class="form-control" [(ngModel)]="taskDetail.taskResultComment" disabled></textarea>
                                <span class="pmd-textfield-focused"></span>
                            </div>
                            <div class="form-group pmd-textfield pmd-textfield-floating-label" [ngClass]="{
                                'pmd-textfield-floating-label-completed': taskDetail.feedbackToAdmin
                            }">
                                <label for="taskName" class="control-label">
                                    {{ 'Task.TaskDetailFeedback' | translate }}
                                </label>
                                <textarea class="form-control" [(ngModel)]="taskDetail.feedbackToAdmin" disabled></textarea>
                                <span class="pmd-textfield-focused"></span>
                            </div>
                        </div>
                        <div class="mt20 text-right">
                            <button class="btn btn-default active" (click)="clickCancel()" disabled>{{ 'Task.Cancel' | translate }}</button>
                            <button class="btn btn-primary" (click)="clickSave()" disabled>{{ 'Task.Save' | translate }}</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="task-detail__status"></div>
        </div>
    </div>
</div>