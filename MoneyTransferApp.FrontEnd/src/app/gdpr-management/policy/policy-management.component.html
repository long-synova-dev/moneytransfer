<modal-dialog [(modalDialog)]="warningDialog">
    <p *ngIf="isOpenMaxStorageQuotaWarning">{{'General.MaxStorageQuotaReached' | translate}}</p>
    <p *ngIf="!isOpenMaxStorageQuotaWarning">{{'General.CantDownloadPDFWarning' | translate}}</p>
    <div class="pmd-modal-bordered text-right">
        <button class="btn pmd-ripple-effect btn-primary" type="button" (click)="goToSubscription()">{{'General.OK' | translate}}</button>
    </div>
</modal-dialog>
<div class="container" *ngIf="readyToLoad">
    <button class="btn-link no-padding" routerLink="/gdpr/management/policy">
        <i class="material-icons">arrow_back</i>
    </button>
    <modal-dialog [(modalDialog)]="deleteConfirm">
        <div class="form-group">
            {{ 'Policy.ConfirmDelete' | translate }}
        </div>
        <div class="text-right">
            <button type="submit" class="btn btn-danger" (click)="delete()">{{ 'General.DeleteBtn' | translate }}</button>
            <button type="submit" class="btn btn-default" (click)="closeDelete()">{{ 'General.CancelBtn' | translate }}</button>
        </div>
    </modal-dialog>
    <h1>{{ 'Policy.ManagePolicy' | translate }}</h1>
    <div class="row row-eq-height">
        <div class="col-xs-4">
            <div class="panel manage-panel">
                <div class="panel-body">
                    {{ 'Policy.Process' | translate }}:
                    <strong>{{policyDetail.processName}}</strong>
                    <br> {{ 'Policy.PolicyType' | translate }}:
                    <strong>{{ ('Policy.' + policyDetail.policyType) | translate }}</strong>
                    <br> {{ 'General.Version' | translate }}:
                    <strong>{{policyDetail.version}}</strong>
                    <br> {{ 'General.Last-Revised' | translate }}:
                    <strong>{{policyDetail.lastUpdated | dateformatpipe: true}}</strong>
                    <br> {{ 'General.Responsible' | translate }}:
                    <strong>{{policyDetail.responsible}}</strong>
                    <br>
                    <div class="lock mt10">
                        <i class="material-icons" *ngIf="policyDetail.isLocked" (click)="clickLock()">lock</i>
                        <i class="material-icons" (click)="clickLock()" *ngIf="!policyDetail.isLocked">lock_open</i>
                        <span>{{ 'General.LockNote' | translate }}</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xs-4">
            <div class="panel manage-panel">
                <div class="panel-body">
                    <strong>{{ 'General.UploadBoxTitle' | translate }}</strong>
                    <form method="post" enctype="multipart/form-data" *ngIf="!isUploaded">
                        <div class="row">
                            <div class="col-xs-8">
                                <div class="form-group pmd-textfield">
                                    <label for="Upload" class="control-label">
                                        {{ 'General.ClickToUpload' | translate }}
                                    </label>
                                    <input type="file" accept="image/png,image/bmp,image/gif,image/jpeg,text/csv,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,application/pdf,application/zip,text/*"
                                        class="btn btn-sm btn-default" ng2FileSelect [uploader]="uploader" class="form-control">
                                    <span class="pmd-textfield-focused"></span>
                                </div>
                            </div>
                            <div class="col-xs-4">
                                <button class="btn btn-sm btn-primary mt20" type="button" (click)="uploader.uploadAll()">
                                    <i class="material-icons pmd-xs upload-button">send</i>
                                </button>
                            </div>
                        </div>
                    </form>
                    <ul class="list-group" *ngIf="isUploaded">
                        <li class="list-group-item">
                            <div class="media-left media-middle">
                                <i class="material-icons pmd-xs">attach_file</i>
                            </div>
                            <div class="media-body media-middle">
                                {{fileName}}
                            </div>
                            <i class="material-icons md-dark media-middle download" (click)="download()" title="{{'General.Download' | translate}}">cloud_download</i>
                            <i class="material-icons md-dark media-middle delete" (click)="confirmDelete()" title="{{'General.Delete' | translate}}">delete</i>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-xs-4">
            <div class="panel manage-panel">
                <div class="panel-body">
                    <strong>{{ 'General.History' | translate }}</strong>
                    <div *ngIf="!policyHistory || policyHistory.length == 0" [innerHtml]="('General.NoHistory' | translate)"></div>
                    <div class="mt10 scroll-history" *ngIf="policyHistory && policyHistory.length > 0">
                        <div *ngFor="let item of policyHistory" class="history-item">
                            <div class="media-left">
                                <span class="btn-avatar">
                                    <div class="user_logo">{{item.avatarName}}</div>
                                </span>
                            </div>
                            <div class="media-body media-middle">
                                <h3 class="pmd-card-title-text">{{item.owner}}</h3>
                                <span class="pmd-card-subtitle-text" [innerHtml]="
                                item.fileChanged ?('General.HistoryFileUpdated' | translate: {owner: item.owner, fieldName: (item.fieldName | translate), newValue: item.newValue})
                                :(
                                    item.oldValue ? 
                                    ('Policy.HistoryUpdated' | translate: {owner: item.owner, fieldName: (item.fieldName | translate), oldValue: item.oldValue, newValue: item.newValue}) :
                                    ('Policy.HistoryAddNew' | translate: {owner: item.owner, newValue:item.newValue,fieldName: (item.fieldName | translate)}))">
                                </span>
                            </div>
                            <div class="media-right">
                                {{item.date | dateformatpipe: true}}
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="form-group mt20">
        <div class="pmd-switch">
            <label>
                <input id="hasSubCompany" [(ngModel)]="useExisting" type="checkbox" (change)="useExistingChange()" [disabled]="policyDetail.isLocked">
                <span class="pmd-switch-label"></span>
            </label>
            <span class="pmd-switch__text">{{ 'Policy.UseAnExistingPolicy' | translate }}</span>
        </div>
    </div>
    <div class="panel" *ngIf="!policyDetail.useExisting">
        <div class="panel-body">
            <div class="lock-area">
                <div class="lock-area__backdrop" *ngIf="policyDetail.isLocked"></div>
                <!-- <div *dynamicComponent="templateHTML"></div> -->
                <ng-template dynamic-template [template]="templateHTML" [extraModules]="ExtraModule"></ng-template>
            </div>
        </div>
    </div>
    <div class="mt20">
        <button class="btn btn-lg pmd-btn-raised pmd-ripple-effect btn-primary" (click)="save()">{{'General.Save' | translate}}</button>
        <button class="btn btn-lg pmd-btn-raised pmd-ripple-effect btn-default" routerLink="/gdpr/management/policy">{{'General.Cancel' | translate}}</button>
        <button class="btn btn-lg pmd-btn-raised pmd-ripple-effect btn-default" [disabled]="!isHasContent" (click)="downloadPDF()">{{'General.DownloadAsPdf' | translate}}</button>
    </div>
    <div class="mt20"></div>

</div>